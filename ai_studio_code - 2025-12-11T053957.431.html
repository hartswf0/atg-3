<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WAG â€“ SYSTEM: CLEANROOM</title>
    <style>
        :root {
            /* The Cleanroom Palette */
            --bg: #f0f2f5;
            --card-bg: #ffffff;
            --text-pri: #111827;
            --text-sec: #6b7280;
            
            --accent: #3b82f6; /* Technical Blue */
            --accent-dim: #dbeafe;
            
            --border: #e5e7eb;
            --shadow: rgba(0, 0, 0, 0.05);
            
            --font-mono: 'Menlo', 'Monaco', 'Courier New', monospace;
            --font-ui: -apple-system, BlinkMacSystemFont, "Inter", sans-serif;
            
            --card-w: 280px;
            --card-h: 360px;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; user-select: none; -webkit-tap-highlight-color: transparent; }

        body {
            background: var(--bg);
            color: var(--text-pri);
            font-family: var(--font-ui);
            height: 100vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        /* --- HEADER --- */
        header {
            flex: 0 0 60px;
            background: var(--card-bg);
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 24px;
            z-index: 100;
        }

        .brand { font-weight: 700; letter-spacing: -0.5px; color: var(--text-pri); font-size: 16px; }
        .brand span { color: var(--accent); }
        
        .readout { font-family: var(--font-mono); font-size: 11px; color: var(--text-sec); background: var(--bg); padding: 4px 8px; border-radius: 4px; }

        /* --- THE TRACK (Horizontal Scroll) --- */
        .track-container {
            flex: 1;
            display: flex;
            align-items: center;
            overflow-x: auto;
            overflow-y: hidden;
            padding: 0 50vw; /* Start/End padding to center first/last items */
            scroll-behavior: smooth;
            scroll-snap-type: x mandatory;
            
            /* Hide Scrollbar */
            scrollbar-width: none; 
            -ms-overflow-style: none;
        }
        .track-container::-webkit-scrollbar { display: none; }

        /* --- THE CARD (Data Block) --- */
        .card {
            flex: 0 0 var(--card-w);
            height: var(--card-h);
            background: var(--card-bg);
            border: 1px solid var(--border);
            border-radius: 12px;
            margin: 0 12px;
            padding: 20px;
            
            scroll-snap-align: center;
            
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            
            transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
            opacity: 0.4;
            transform: scale(0.9);
            box-shadow: 0 4px 6px var(--shadow);
        }

        /* Active State */
        .card.active {
            opacity: 1;
            transform: scale(1);
            border-color: var(--accent);
            box-shadow: 0 20px 25px -5px rgba(59, 130, 246, 0.15), 0 10px 10px -5px rgba(59, 130, 246, 0.1);
            z-index: 10;
        }

        /* Top: ID & Viz */
        .c-top { height: 160px; border-bottom: 1px solid var(--border); margin-bottom: 12px; padding-bottom: 12px; position: relative; }
        
        .c-id { 
            position: absolute; top: 0; left: 0; 
            font-family: var(--font-mono); font-size: 12px; color: var(--text-sec); 
            font-weight: bold;
        }
        
        canvas { width: 100%; height: 100%; display: block; opacity: 0.2; transition: opacity 0.3s; }
        .card.active canvas { opacity: 1; }

        /* Bottom: Data */
        .c-bot { font-family: var(--font-mono); font-size: 10px; color: var(--text-sec); display: flex; flex-direction: column; gap: 8px; }
        
        .d-row { display: flex; justify-content: space-between; }
        .lbl { text-transform: uppercase; letter-spacing: 0.5px; opacity: 0.7; }
        .val { color: var(--text-pri); font-weight: 600; }
        .card.active .val { color: var(--accent); }

        /* --- CONTROLS --- */
        footer {
            height: 70px;
            background: var(--card-bg);
            border-top: 1px solid var(--border);
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 16px;
            z-index: 100;
        }

        .btn {
            background: var(--bg);
            border: 1px solid var(--border);
            color: var(--text-pri);
            padding: 10px 24px;
            border-radius: 8px;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: 0.2s;
        }
        .btn:hover { border-color: var(--accent); color: var(--accent); }
        
        .btn.primary { background: var(--accent); color: white; border-color: var(--accent); }
        .btn.primary:hover { background: #2563eb; }
        
        .btn.active { background: #eff6ff; color: var(--accent); border-color: var(--accent); }

        /* --- OVERLAY (Center Line) --- */
        .center-line {
            position: fixed; top: 50%; left: 50%; 
            width: 2px; height: calc(var(--card-h) + 40px);
            background: var(--accent);
            transform: translate(-50%, -50%);
            z-index: 0;
            opacity: 0.2;
            border-radius: 2px;
            pointer-events: none;
        }

    </style>
</head>
<body>

<header>
    <div class="brand">WAG<span>//CLEANROOM</span></div>
    <div class="readout" id="statusReadout">SYSTEM READY</div>
</header>

<div class="center-line"></div>

<div class="track-container" id="track">
    <!-- Cards Injected Here -->
</div>

<footer>
    <button class="btn" id="initBtn" onclick="initAudio()">ACTIVATE AUDIO</button>
    <button class="btn" id="runBtn" onclick="toggleFeed()">AUTO-FEED</button>
</footer>

<script>
    /* --- DATA --- */
    const DATA = [
        {id: "003238a", name: "Shield Crown", color: "Pink", size: 1406},
        {id: "003238b", name: "Shield Chevron", color: "Yellow", size: 1127},
        {id: "3001", name: "Brick 2x4", color: "Blue", size: 2200},
        {id: "3005", name: "Brick 1x1", color: "Red", size: 500},
        {id: "003238e", name: "Vest Crown", color: "Pink", size: 1394},
        {id: "3020", name: "Plate 2x4", color: "White", size: 1755},
        {id: "3009", name: "Brick 1x6", color: "Grey", size: 595},
        {id: "003381a", name: "Sticker Hover", color: "White", size: 21547},
        {id: "003428a", name: "Sticker Choco", color: "Blue", size: 15653},
        {id: "003428c", name: "Suit Black", color: "Black", size: 5194}
    ];

    const state = {
        ctx: null,
        master: null,
        activeIdx: -1,
        running: false,
        timer: null,
        observer: null
    };

    /* --- CLEAN AUDIO ENGINE --- */
    // Logic: Short, crisp, pentatonic plucks. No delays. No harsh noise.
    const AUDIO = {
        init: () => {
            if(state.ctx) return;
            const AC = window.AudioContext || window.webkitAudioContext;
            state.ctx = new AC();
            state.master = state.ctx.createGain();
            state.master.gain.value = 0.3; // Low volume for pleasantness
            state.master.connect(state.ctx.destination);
            
            document.getElementById('initBtn').textContent = "AUDIO ACTIVE";
            document.getElementById('initBtn').style.opacity = "0.5";
        },

        playNote: (item) => {
            if(!state.ctx) return;
            const t = state.ctx.currentTime;

            // C Major Pentatonic Scale (Frequencies) - Always harmonious
            const scale = [261.63, 293.66, 329.63, 392.00, 440.00, 523.25]; 
            
            // Map size to note (Smaller = Higher)
            const noteIdx = Math.floor(item.size / 1000) % scale.length;
            const freq = scale[noteIdx];

            const osc = state.ctx.createOscillator();
            const gain = state.ctx.createGain();

            // Sine wave for "Pure" tone
            osc.type = 'sine'; 
            osc.frequency.setValueAtTime(freq, t);

            // PLUCK ENVELOPE: Instant attack, fast decay. Like a marimba.
            gain.gain.setValueAtTime(0, t);
            gain.gain.linearRampToValueAtTime(0.5, t + 0.01); 
            gain.gain.exponentialRampToValueAtTime(0.001, t + 0.3); // 300ms duration max

            osc.connect(gain);
            gain.connect(state.master);

            osc.start(t);
            osc.stop(t + 0.3);
        }
    };

    /* --- DOM BUILDER --- */
    function build() {
        const track = document.getElementById('track');
        track.innerHTML = '';
        
        DATA.forEach((d, i) => {
            const el = document.createElement('div');
            el.className = 'card';
            el.id = `c-${i}`;
            el.dataset.idx = i;
            
            el.innerHTML = `
                <div class="c-top">
                    <span class="c-id">${String(i).padStart(2,'0')}</span>
                    <canvas id="cvs-${i}"></canvas>
                </div>
                <div class="c-bot">
                    <div class="d-row"><span class="lbl">FILE</span> <span class="val">${d.name}</span></div>
                    <div class="d-row"><span class="lbl">COLOR</span> <span class="val" style="color:${getColor(d.color)}">${d.color}</span></div>
                    <div class="d-row"><span class="lbl">SIZE</span> <span class="val">${d.size} B</span></div>
                </div>
            `;
            track.appendChild(el);
            setTimeout(() => drawIcon(i, d), 50);
        });
        
        setupObserver();
    }

    function getColor(name) {
        const map = { 'Pink':'#db2777', 'Yellow':'#ca8a04', 'Blue':'#2563eb', 'Red':'#dc2626', 'White':'#9ca3af', 'Grey':'#4b5563', 'Black':'#000' };
        return map[name] || '#000';
    }

    /* --- DRAWING (Clean Vector Style) --- */
    function drawIcon(idx, data) {
        const cvs = document.getElementById(`cvs-${idx}`);
        const ctx = cvs.getContext('2d');
        const w = cvs.clientWidth;
        const h = cvs.clientHeight;
        cvs.width = w; cvs.height = h;
        
        const cx = w/2;
        const cy = h/2;
        
        ctx.clearRect(0,0,w,h);
        ctx.strokeStyle = "#111827";
        ctx.lineWidth = 1.5;
        
        // Draw Isometric Cube representing the brick
        const s = 30; // size
        
        ctx.beginPath();
        ctx.moveTo(cx, cy - s);
        ctx.lineTo(cx + s, cy - s/2);
        ctx.lineTo(cx + s, cy + s/2);
        ctx.lineTo(cx, cy + s);
        ctx.lineTo(cx - s, cy + s/2);
        ctx.lineTo(cx - s, cy - s/2);
        ctx.closePath();
        
        // Inner lines
        ctx.moveTo(cx, cy);
        ctx.lineTo(cx, cy + s);
        ctx.moveTo(cx, cy);
        ctx.lineTo(cx + s, cy - s/2);
        ctx.moveTo(cx, cy);
        ctx.lineTo(cx - s, cy - s/2);
        
        ctx.stroke();
        
        // Fill with subtle color
        ctx.fillStyle = getColor(data.color) + '20'; // 20 hex = low opacity
        ctx.fill();
    }

    /* --- LOGIC --- */
    function setupObserver() {
        const opts = {
            root: document.getElementById('track'),
            rootMargin: "-50% 0px -50% 0px", // Exact center line trigger
            threshold: 0
        };

        const obs = new IntersectionObserver((entries) => {
            entries.forEach(e => {
                if (e.isIntersecting) activate(e.target);
                else e.target.classList.remove('active');
            });
        }, opts);

        document.querySelectorAll('.card').forEach(c => obs.observe(c));
    }

    function activate(el) {
        el.classList.add('active');
        const idx = parseInt(el.dataset.idx);
        state.activeIdx = idx;
        
        // Play Clean Pluck
        AUDIO.playNote(DATA[idx]);
        
        document.getElementById('statusReadout').textContent = `READING: ${DATA[idx].id} // ${DATA[idx].name}`;
    }

    function initAudio() {
        AUDIO.init();
    }

    function toggleFeed() {
        const btn = document.getElementById('runBtn');
        if (state.running) {
            state.running = false;
            clearTimeout(state.timer);
            btn.classList.remove('primary');
            btn.textContent = "AUTO-FEED";
        } else {
            if(!state.ctx) AUDIO.init();
            state.running = true;
            btn.classList.add('primary');
            btn.textContent = "STOP FEED";
            loop();
        }
    }

    function loop() {
        if(!state.running) return;
        const next = (state.activeIdx + 1) % DATA.length;
        const el = document.getElementById(`c-${next}`);
        
        if(el) {
            // "Center" scroll into view
            el.scrollIntoView({ behavior: 'smooth', inline: 'center', block: 'nearest' });
        }
        
        // 800ms rhythmic pulse
        state.timer = setTimeout(loop, 800);
    }

    // Boot
    build();

</script>
</body>
</html>